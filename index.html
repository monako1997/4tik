<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>4Tik Pro</title>

  <!-- ğŸŒŸ PWA -->
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta name="theme-color" content="#0a0b12">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="4Tik Pro">

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0a0b12;--ink:#f3f6fb;--muted:#aab6c5;--line:#1d2433;--c1:#25F4EE;--c2:#FE2C55;}
    *{box-sizing:border-box;font-family:'Cairo',sans-serif}
    body{margin:0;min-height:100vh;display:flex;flex-direction:column;align-items:center;color:var(--ink);
      background:radial-gradient(800px 400px at 15% -10%, rgba(37,244,238,.12), transparent 60%),
                 radial-gradient(900px 500px at 110% -20%, rgba(254,44,85,.12), transparent 60%),
                 linear-gradient(180deg,#080910 0%, #0a0b12 100%);}
    .topbar{position:sticky;top:0;width:100%;display:flex;justify-content:center;align-items:center;padding:14px 16px;
      backdrop-filter:saturate(140%) blur(6px);background:linear-gradient(180deg, rgba(10,11,18,.65), rgba(10,11,18,0));z-index:10;}
    .brand{font-weight:900;font-size:42px;letter-spacing:.6px;margin:0;background:linear-gradient(90deg,var(--c2),var(--c1),var(--c2));
      -webkit-background-clip:text;background-clip:text;color:transparent;text-shadow:0 0 18px rgba(37,244,238,.35),0 0 18px rgba(254,44,85,.25);
      background-size:200% auto;animation:shine 3s linear infinite;}
    @keyframes shine { to { background-position:-200% center; } }

    .wrap{width:min(900px,96vw); padding:20px 16px 160px;}
    .card{background:#0f1320;border:1px solid var(--line);border-radius:16px;padding:22px;box-shadow:0 20px 60px rgba(0,0,0,.35);margin-bottom:14px}
    .upload{position:relative;border-radius:16px;padding:28px;text-align:center;cursor:pointer;background:rgba(255,255,255,.02);
      border:2px dashed #314055;overflow:hidden;isolation:isolate}
    .upload::before{content:"";position:absolute;inset:-2px;z-index:-1;border-radius:18px;
      background:conic-gradient(from 0deg,var(--c1),var(--c2),var(--c1));filter:blur(14px);opacity:.45}
    .u-title{display:inline-block;font-weight:800;font-size:22px;text-transform:uppercase;background:linear-gradient(90deg,var(--c1),var(--c2));
      -webkit-background-clip:text;background-clip:text;color:transparent}
    .hint{margin-top:6px;color:var(--muted);font-size:14px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:14px}
    button{padding:12px 22px;border:0;border-radius:12px;font-weight:700;cursor:pointer;font-size:16px;
      background:linear-gradient(90deg,var(--c2),var(--c1));color:#0a0b12;box-shadow:0 8px 24px rgba(37,244,238,.18),0 8px 24px rgba(254,44,85,.16)}
    button[disabled]{opacity:.6;cursor:not-allowed}
    .bar-wrap{height:14px;background:#0a0f1a;border:1px solid var(--line);border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0%;border-radius:999px;background:linear-gradient(90deg,var(--c2),var(--c1));transition:width .12s}
    .bar.running{animation:slide 1.1s linear infinite;background:linear-gradient(90deg,transparent 0%,rgba(255,255,255,.15) 50%,transparent 100%);width:40%}
    @keyframes slide{from{margin-inline-start:-40%}to{margin-inline-start:100%}}
    .status{font-size:14px;color:var(--muted)}
    .footer{position:fixed;bottom:15px;left:0;right:0;text-align:center;font-size:18px;font-weight:700;color:var(--ink);
      display:flex;justify-content:center;align-items:center;gap:10px;z-index:20}
    .heart{color:var(--c2);font-size:20px;animation:beat 1s infinite}
    @keyframes beat{0%,20%,40%,60%,80%,100%{transform:scale(1)}10%,30%,50%,70%,90%{transform:scale(1.3)}}
    ul.guide{padding:0 20px;margin:0;line-height:1.8}
    ul.guide li{margin-bottom:6px;color:var(--muted)}
  </style>
</head>
<body>
  <header class="topbar"><h1 class="brand">4Tik Pro</h1></header>

  <main class="wrap">
    <!-- Ø±ÙØ¹ -->
    <section class="card">
      <div id="drop" class="upload">
        <input id="file" type="file" accept="video/*" hidden />
        <div class="u-title">upload video</div>
        <div id="fileInfo" class="hint">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù‚Ø·Ø¹ Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</div>
      </div>
      <div class="row">
        <button id="process" disabled>Ù…Ø¹Ø§Ù„Ø¬Ø©</button>
        <div id="status" class="status" style="margin-inline-start:auto"></div>
      </div>
      <div class="bar-wrap" style="margin-top:12px"><div id="bar" class="bar"></div></div>
    </section>

    <!-- Ø§Ø´ØªØ±Ø§Ùƒ -->
    <section class="card">
      <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
        <button id="showSub">Ø¹Ø±Ø¶ Ø§Ø´ØªØ±Ø§ÙƒÙŠ</button>
        <button id="copyKey" style="background:#fff;color:#0a0b12">Ù†Ø³Ø® Ù…ÙØªØ§Ø­ÙŠ</button>
        <div id="subToast" style="font-size:13px;color:#aab6c5"></div>
      </div>
      <div style="margin-top:10px;line-height:1.9">
        <div>Ø§Ù„Ù…ÙØªØ§Ø­: <b id="subKey">â€”</b></div>
        <div>ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ: <b id="subExp">â€”</b></div>
        <div>Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: <b id="subDays">â€”</b></div>
        <div>Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø¨Ø·: <b id="subBind">â€”</b></div>
        <div>Ø¢Ø®Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…: <b id="subLast">â€”</b></div>
      </div>
    </section>

    <!-- ØªØ¹Ù„ÙŠÙ…Ø§Øª -->
    <section class="card">
      <h3 style="margin-top:0;color:var(--c1)">ğŸ“Œ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù…Ù‡Ù…Ø©</h3>
      <ul class="guide">
        <li>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø­Ø¬Ù… Ù…Ù„Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: <b>100 Ù…ÙŠÙ‚Ø§</b>.</li>
        <li>Ø¨Ø¹Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆØªÙ†Ø²ÙŠÙ„Ù‡ØŒ Ø§ÙØªØ­ ØªØ·Ø¨ÙŠÙ‚ <b>TikTok</b> ÙˆØ§Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙƒÙ€<strong>Ø®Ø§Øµ</strong>.</li>
        <li>Ø¨Ø¹Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø±ÙØ¹ØŒ ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ±Ù‡ Ù…Ù† Ø®Ø§Øµ Ø¥Ù„Ù‰ <strong>Ø¹Ø§Ù…</strong>.</li>
      </ul>
    </section>
  </main>

  <div class="footer">Made by Manal <span class="heart">â¤</span></div>

  <!-- ==================== Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª ==================== -->
  <script>
    const drop=document.getElementById('drop'),fileInput=document.getElementById('file'),info=document.getElementById('fileInfo'),
    processBtn=document.getElementById('process'),bar=document.getElementById('bar'),status=document.getElementById('status'),
    showSubBtn=document.getElementById('showSub'),copyKeyBtn=document.getElementById('copyKey'),
    subKey=document.getElementById('subKey'),subExp=document.getElementById('subExp'),subDays=document.getElementById('subDays'),
    subBind=document.getElementById('subBind'),subLast=document.getElementById('subLast'),subToast=document.getElementById('subToast');
    const mb=n=>(n/1024/1024).toFixed(2)+' MB';

    async function sha256(t){const e=new TextEncoder().encode(t),n=await crypto.subtle.digest('SHA-256',e);return Array.from(new Uint8Array(n)).map(t=>t.toString(16).padStart(2,'0')).join('')}

    function canvasFingerprint(){try{const e=document.createElement('canvas');e.width=200,e.height=60;const t=e.getContext('2d');return t.textBaseline='top',t.font='16px Arial',t.fillStyle='#f60',t.fillRect(0,0,200,30),t.fillStyle='#069',t.fillText('4TikPro-fp',2,2),t.strokeStyle='#f00',t.arc(100,30,20,0,2*Math.PI),t.stroke(),e.toDataURL()}catch{return'no-canvas'}}
    function webglInfo(){try{const e=document.createElement('canvas'),t=e.getContext('webgl')||e.getContext('experimental-webgl');if(!t)return'no-webgl';const n=t.getExtension('WEBGL_debug_renderer_info');return(n?t.getParameter(n.UNMASKED_VENDOR_WEBGL):'v?')+'|'+(n?t.getParameter(n.UNMASKED_RENDERER_WEBGL):'r?')}catch{return'no-webgl'}}
    async function getDeviceHash(){const e=[navigator.platform||'pf?',(screen.width||0)+'x'+(screen.height||0),window.devicePixelRatio||1,navigator.hardwareConcurrency||'hc?',navigator.deviceMemory||'dm?',navigator.maxTouchPoints||0,Intl.DateTimeFormat().resolvedOptions().timeZone||'tz?',canvasFingerprint(),webglInfo()].join('|');return await sha256(e)}

    async function getKey(t=!1){let e=localStorage.getItem('SUB_KEY');if(e)return e;if(t){const t=await getDeviceHash();try{const e=await fetch('/check',{method:'POST',headers:{'X-DEVICE':t}}),a=await e.json();if(e.ok&&a.ok)return'__DEVICE_ONLY__'}catch{}}return(e=prompt('Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ'))?(localStorage.setItem('SUB_KEY',e.trim()),e):null}

    function updateInfo(){const e=fileInput.files[0];status.textContent='',e?(info.textContent=`Ø§Ù„Ù…Ù„Ù: ${e.name} â€” ${mb(e.size)}`,processBtn.disabled=!1):(info.textContent='Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù‚Ø·Ø¹ Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±',processBtn.disabled=!0)}
    drop.addEventListener('click',()=>fileInput.click()),drop.addEventListener('dragover',e=>e.preventDefault()),drop.addEventListener('drop',e=>{e.preventDefault(),e.dataTransfer.files.length&&(fileInput.files=e.dataTransfer.files,updateInfo())}),fileInput.addEventListener('change',updateInfo);

    processBtn.addEventListener('click',async()=>{const e=fileInput.files[0];if(!e)return;const t=await getKey(!0);if(!t)return void alert('Ø§Ù„Ù…ÙØªØ§Ø­ Ù…Ø·Ù„ÙˆØ¨');const a=await getDeviceHash();status.textContent='Ø¬Ø§Ø±Ù Ø§Ù„Ø±ÙØ¹â€¦',bar.classList.remove('running'),bar.style.width='0%',processBtn.disabled=!0,fileInput.disabled=!0,drop.style.pointerEvents='none',drop.style.opacity='0.5';const s=new FormData;s.append('file',e);const r=new XMLHttpRequest;r.open('POST','/process',!0),r.responseType='blob','__DEVICE_ONLY__'!==t&&r.setRequestHeader('X-KEY',t),r.setRequestHeader('X-DEVICE',a),r.upload.onprogress=e=>{e.lengthComputable&&(bar.style.width=Math.round(e.loaded/e.total*100)+'%')},r.onreadystatechange=()=>{4===r.readyState&&(bar.classList.remove('running'),200===r.status?(status.textContent='ØªÙ…Ù‘Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© â€” ÙŠØ¨Ø¯Ø£ Ø§Ù„ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ø¢Ù†',(()=>{const e=r.response,t=URL.createObjectURL(e),a=document.createElement('a');a.href=t,a.download='output.mp4',document.body.appendChild(a),a.click(),URL.revokeObjectURL(t),a.remove()})(),setTimeout(()=>{drop.style.pointerEvents='auto',drop.style.opacity='1',fileInput.disabled=!1,fileInput.value='',updateInfo()},800)):(new FileReader).onload=()=>{status.textContent=reader.result||'Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ù‹Ø§.'},drop.style.pointerEvents='auto',drop.style.opacity='1',fileInput.disabled=!1,updateInfo(),401===r.status&&localStorage.removeItem('SUB_KEY'))},r.send(s)});

    async function refreshSubscriptionBox(t=!1){try{const e=await getKey(!0);if(!e)return void(t||alert('Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø£ÙˆÙ„Ø§Ù‹'));const a=await getDeviceHash(),s={'X-DEVICE':a};'__DEVICE_ONLY__'!==e&&(s['X-KEY']=e);const r=await fetch('/me',{headers:s}),o=await r.json();if(!r.ok)return subKey.textContent='â€”',subExp.textContent='â€”',subDays.textContent='â€”',subBind.textContent=o.error||'ØºÙŠØ± Ù…ØªÙˆÙØ±',void(subLast.textContent='â€”');let n=o.key_masked||'â€”',c=localStorage.getItem('SUB_KEY');c&&'__DEVICE_ONLY__'!==c&&(n=c.substring(0,4)+'****'+c.slice(-4)),subKey.textContent=n,subExp.textContent=o.expires||'â€”',subDays.textContent=null!=o.days_left?o.days_left:'â€”',subBind.textContent=o.bound===!1?'ØºÙŠØ± Ù…Ø±Ø¨ÙˆØ· Ø¨Ø¹Ø¯':o.bound_to_this_device?'Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²':'Ù…Ø±Ø¨ÙˆØ· Ø¨Ø¬Ù‡Ø§Ø² Ø¢Ø®Ø±',subLast.textContent=o.last_used?o.last_used:'â€”',t||(subToast.textContent='âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ',setTimeout(()=>subToast.textContent='',2e3))}catch(e){subToast.textContent='ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ',setTimeout(()=>subToast.textContent='',2e3)}}
    showSubBtn?.addEventListener('click',()=>refreshSubscriptionBox(!1)),copyKeyBtn?.addEventListener('click',async()=>{const e=localStorage.getItem('SUB_KEY');if(!e)return void alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙØªØ§Ø­ Ù…Ø­ÙÙˆØ¸ Ø¨Ø¹Ø¯.');try{await navigator.clipboard.writeText(e),subToast.textContent='ğŸ“‹ ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…ÙØªØ§Ø­',setTimeout(()=>subToast.textContent='',2e3)}catch{subToast.textContent='ØªØ¹Ø°Ø± Ø§Ù„Ù†Ø³Ø®ØŒ Ø§Ù†Ø³Ø®Ù‡ ÙŠØ¯ÙˆÙŠÙ‹Ø§.',setTimeout(()=>subToast.textContent='',2e3)}}),window.addEventListener('load',()=>{refreshSubscriptionBox(!0)});

    // ğŸŒŸ ØªØ³Ø¬ÙŠÙ„ Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => console.log('âœ… Service Worker Ù…Ø³Ø¬Ù„:', reg.scope))
          .catch(err => console.log('âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ SW:', err));
      });
    }
  </script>
</body>
</html>