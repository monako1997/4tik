<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0f1320">
  <title>4TIK PRO ⚡️</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0a0b12; --ink:#f3f6fb; --muted:#aab6c5; --line:#1d2433;
      --c1:#25F4EE; /* TikTok Cyan */
      --c2:#FE2C55; /* TikTok Pink */
    }
    html { scroll-behavior: smooth; }
    *{ box-sizing: border-box; font-family: 'Cairo', sans-serif; }
    body{
      margin:0; min-height:100vh; display:flex; flex-direction:column; align-items:center; color:var(--ink);
      background-color: var(--bg);
      background-image:
        radial-gradient(ellipse 50vw 30vh at 15% -10%, rgba(37,244,238,.12), transparent 80%),
        radial-gradient(ellipse 60vw 40vh at 110% -20%, rgba(254,44,85,.12), transparent 80%),
        linear-gradient(180deg, #080910 0%, #0a0b12 100%);
      background-attachment: fixed;
    }
    .topbar{
      position:sticky; top:0; width:100%; display:flex; justify-content:center; align-items:center; padding:14px 16px;
      backdrop-filter: saturate(140%) blur(8px);
      background: linear-gradient(180deg, rgba(10,11,18,.75), rgba(10,11,18,0)); z-index:10;
    }
    .brand{
      font-weight:900; font-size:42px; letter-spacing:.6px; margin:0;
      background: linear-gradient(90deg, var(--c2), var(--c1), var(--c2));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow: 0 0 18px rgba(37,244,238,.35), 0 0 18px rgba(254,44,85,.25);
      background-size: 200% auto; animation: shine 3s linear infinite;
      transition: font-size 0.3s ease;
    }
    @keyframes shine { to { background-position:-200% center; } }
    .wrap{
      width: min(900px, 94vw);
      padding: 20px 0 160px;
    }
    .card{
      background: rgba(15, 19, 32, 0.8);
      border: 1px solid var(--line); border-radius:18px;
      padding: 24px; box-shadow:0 20px 60px rgba(0,0,0,.35); margin-bottom:16px;
      transition: all 0.3s ease;
    }
    .upload{
      position:relative; border-radius:16px; padding:28px; text-align:center; cursor:pointer;
      background:rgba(255,255,255,.02); border:2px dashed #314055;
      overflow:hidden; isolation:isolate; transition: transform 0.3s ease;
    }
    .upload:hover { transform: scale(1.02); }
    .u-title{
      display:inline-block; font-weight:800; font-size:22px; text-transform:uppercase;
      background: linear-gradient(90deg,var(--c1),var(--c2));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      transition: font-size 0.3s ease;
    }
    .hint{ margin-top:6px; color:var(--muted); font-size:14px; }
    .row{
      display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-top:16px;
    }
    .controls-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      margin-top: 25px;
      margin-bottom: 10px;
    }
    
    /* --- بداية تصميم الزر الجديد --- */
    .btn {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 14rem; /* زيادة العرض قليلا ليناسب النصوص العربية */
      overflow: hidden;
      height: 3.5rem; /* زيادة الارتفاع قليلا */
      background-size: 300% 300%;
      cursor: pointer;
      backdrop-filter: blur(1rem);
      border-radius: 5rem;
      transition: 0.5s;
      animation: gradient_301 5s ease infinite;
      border: double 4px transparent;
      background-image: linear-gradient(#212121, #212121),
        linear-gradient( 137.48deg, #ffdb3b 10%, #fe53bb 45%, #8f51ea 67%, #0044ff 87%);
      background-origin: border-box;
      background-clip: content-box, border-box;
    }

    .btn .container-stars {
      position: absolute;
      z-index: -1;
      width: 100%;
      height: 100%;
      overflow: hidden;
      transition: 0.5s;
      backdrop-filter: blur(1rem);
      border-radius: 5rem;
    }

    .btn strong {
      z-index: 2;
      font-size: 16px; /* تعديل حجم الخط */
      letter-spacing: 2px; /* تعديل تباعد الأحرف */
      color: #ffffff;
      text-shadow: 0 0 4px white;
      font-weight: bold;
    }

    .btn .glow {
      position: absolute;
      display: flex;
      width: 12rem;
    }

    .btn .circle {
      width: 100%;
      height: 30px;
      filter: blur(2rem);
      animation: pulse_3011 4s infinite;
      z-index: -1;
    }

    .btn .circle:nth-of-type(1) {
      background: rgba(254, 83, 186, 0.636);
    }

    .btn .circle:nth-of-type(2) {
      background: rgba(142, 81, 234, 0.704);
    }

    .btn:hover .container-stars {
      z-index: 1;
      background-color: #212121;
    }

    .btn:hover {
      transform: scale(1.1);
    }

    .btn:active {
      border: double 4px #fe53bb;
      background-origin: border-box;
      background-clip: content-box, border-box;
      animation: none;
    }

    .btn:active .circle {
      background: #fe53bb;
    }

    .btn .stars {
      position: relative;
      background: transparent;
      width: 200rem;
      height: 200rem;
    }

    .btn .stars::after {
      content: "";
      position: absolute;
      top: -10rem;
      left: -100rem;
      width: 100%;
      height: 100%;
      animation: animStarRotate 90s linear infinite;
      background-image: radial-gradient(#ffffff 1px, transparent 1%);
      background-size: 50px 50px;
    }

    .btn .stars::before {
      content: "";
      position: absolute;
      top: 0;
      left: -50%;
      width: 170%;
      height: 500%;
      animation: animStar 60s linear infinite;
      background-image: radial-gradient(#ffffff 1px, transparent 1%);
      background-size: 50px 50px;
      opacity: 0.5;
    }
    
    /* حالة التعطيل للزر */
    .btn[disabled] {
      cursor: not-allowed;
      filter: grayscale(70%);
      animation: none;
      pointer-events: none;
    }
    .btn[disabled]:hover {
      transform: scale(1);
    }
    .btn[disabled] .container-stars, .btn[disabled] .glow {
      display: none;
    }

    @keyframes animStar { from { transform: translateY(0); } to { transform: translateY(-135rem); } }
    @keyframes animStarRotate { from { transform: rotate(360deg); } to { transform: rotate(0); } }
    @keyframes gradient_301 { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
    @keyframes pulse_3011 { 0% { transform: scale(0.75); box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.7); } 70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(0, 0, 0, 0); } 100% { transform: scale(0.75); box-shadow: 0 0 0 0 rgba(0, 0, 0, 0); } }
    /* --- نهاية تصميم الزر الجديد --- */

    .bar-wrap{ height:14px; background:#0a0f1a; border:1px solid var(--line); border-radius:999px; overflow:hidden; width: 100%; }
    .bar{ height:100%; width:0%; border-radius:999px; background:linear-gradient(90deg,var(--c2),var(--c1)); transition:width .12s; }
    .bar.running{
      animation:slide 1.1s linear infinite;
      background:linear-gradient(90deg,transparent 0%,rgba(255,255,255,.15) 50%,transparent 100%); width:40%;
    }
    @keyframes slide{ from{margin-inline-start:-40%} to{margin-inline-start:100%} }
    .status{ font-size:14px; color:var(--muted); height: 20px; }
    .footer{
      position:fixed; bottom:15px; left:0; right:0; text-align:center; font-size:18px;
      font-weight:700; color:var(--ink); display:flex; justify-content:center;
      align-items:center; gap:10px; z-index:20;
    }
    .heart{ color:var(--c2); font-size:20px; animation:beat 1s infinite; }
    @keyframes beat{ 0%,100%{transform:scale(1)} 50%{transform:scale(1.3)} }
    ul.guide{ padding:0 20px 0 0; margin:0; line-height:1.8; }
    ul.guide li{ margin-bottom:6px; color:var(--muted); }

    @media (max-width: 600px) {
      .brand { font-size: 34px; }
      .wrap { padding-bottom: 120px; }
      .card { padding: 20px; }
      .upload { padding: 24px; }
      .u-title { font-size: 18px; }
      .row { flex-direction: column; align-items: stretch; gap: 14px; }
      #process { width: 100%; max-width: 300px; }
      .footer { font-size: 15px; }
    }
  </style>
</head>
<body>
  <header class="topbar"><h1 class="brand">4TIK PRO ⚡️</h1></header>
  <main class="wrap">
    <section class="card">
      <div id="drop" class="upload">
        <input id="file" type="file" accept="video/*" hidden />
        <div class="u-title">upload video</div>
        <div id="fileInfo" class="hint">اسحب المقطع هنا أو اضغط للاختيار</div>
      </div>
      
      <div class="controls-wrap">
        <button type="button" id="process" class="btn" disabled>
          <strong>معالجة</strong>
          <div class="container-stars">
            <div class="stars"></div>
          </div>
          <div class="glow">
            <div class="circle"></div>
            <div class="circle"></div>
          </div>
        </button>
        <div id="status" class="status"></div>
        <div class="bar-wrap"><div id="bar" class="bar"></div></div>
      </div>

    </section>

    <section class="card">
      <div class="row" style="justify-content: center;">
        <button type="button" id="showSub" class="btn">
            <strong>عرض اشتراكي</strong>
            <div class="container-stars">
              <div class="stars"></div>
            </div>
            <div class="glow">
              <div class="circle"></div>
              <div class="circle"></div>
            </div>
          </button>
        <div id="subToast" style="font-size:13px;color:#aab6c5; flex-basis: 100%; text-align: center;"></div>
      </div>
      <div style="margin-top:10px;line-height:1.9">
        <div>المفتاح: <b id="subKey">—</b></div>
        <div>ينتهي في: <b id="subExp">—</b></div>
        <div>الأيام المتبقية: <b id="subDays">—</b></div>
        <div>حالة الربط: <b id="subBind">—</b></div>
        <div>الجهاز المربوط: <b id="subDevice">—</b></div>
        <div>آخر استخدام: <b id="subLast">—</b></div>
      </div>
    </section>

    <section class="card">
      <h3 style="margin-top:0;color:var(--c1)">ℹ️ تعليمات مهمة</h3>
      <ul class="guide">
        <li>الحد الأقصى لحجم ملف الفيديو: <b>200 ميقا</b>.</li>
        <li>بعد اكتمال معالجة الفيديو وتنزيله، افتح تطبيق <b>TikTok</b> وارفع الفيديو كـ<strong>خاص</strong>.</li>
        <li>بعد اكتمال الرفع، يمكنك تغييره من خاص إلى <strong>عام</strong>.</li>
      </ul>
    </section>
  </main>
  <div class="footer">Made by Manal <span class="heart">🎀</span></div>

  <script>
    const drop=document.getElementById('drop'),fileInput=document.getElementById('file'),info=document.getElementById('fileInfo'),
    processBtn=document.getElementById('process'),bar=document.getElementById('bar'),status=document.getElementById('status'),
    showSubBtn=document.getElementById('showSub'),subKey=document.getElementById('subKey'),
    subExp=document.getElementById('subExp'),subDays=document.getElementById('subDays'),subBind=document.getElementById('subBind'),
    subDevice=document.getElementById('subDevice'),subLast=document.getElementById('subLast'),subToast=document.getElementById('subToast');
    const mb=n=>(n/1024/1024).toFixed(2)+' MB';
    function getDeviceName(){const ua=navigator.userAgent;if(/mobile/i.test(ua)){if(/iphone|ipad|ipod/i.test(ua))return"Apple Device";if(/android/i.test(ua)){const matches=ua.match(/Android\s+[\d\.]+;\s+([\w\s]+)\s+Build/i);if(matches&&matches.length>1)return matches[1];return"Android Device"}}if(/windows/i.test(ua))return"Windows PC";if(/macintosh|mac os x/i.test(ua))return"Mac";return"Unknown Device"}
    async function sha256(text){const enc=new TextEncoder().encode(text),buf=await crypto.subtle.digest('SHA-256',enc);return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('')}
    function canvasFingerprint(){try{const c=document.createElement('canvas');c.width=200;c.height=60;const g=c.getContext('2d');g.textBaseline='top';g.font='16px Arial';g.fillStyle='#f60';g.fillRect(0,0,200,30);g.fillStyle='#069';g.fillText('4TikPro-fp',2,2);g.strokeStyle='#f00';g.arc(100,30,20,0,Math.PI*2);g.stroke();return c.toDataURL()}catch{return'no-canvas'}}
    function webglInfo(){try{const c=document.createElement('canvas'),gl=c.getContext('webgl')||c.getContext('experimental-webgl');if(!gl)return'no-webgl';const dbg=gl.getExtension('WEBGL_debug_renderer_info');return(dbg?gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL):'v?')+'|'+(dbg?gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL):'r?')}catch{return'no-webgl'}}
    async function getDeviceHash(){const seedParts=[navigator.platform||'pf?',(screen.width||0)+'x'+(screen.height||0),window.devicePixelRatio||1,navigator.hardwareConcurrency||'hc?',navigator.deviceMemory||'dm?',navigator.maxTouchPoints||0,Intl.DateTimeFormat().resolvedOptions().timeZone||'tz?',canvasFingerprint(),webglInfo()];return await sha256(seedParts.join('|'))}
    async function getKey(autoCheck=!1){let k=localStorage.getItem('SUB_KEY');if(k)return k;k=prompt('أدخل مفتاح الاشتراك');if(!k)return null;localStorage.setItem('SUB_KEY',k.trim());return k}
    function updateInfo(){const f=fileInput.files[0];status.textContent='';if(!f){info.textContent='اسحب المقطع هنا أو اضغط للاختيار';processBtn.disabled=!0;return}
    const MAX_SIZE=209715200;if(f.size>MAX_SIZE){info.textContent=`الملف: ${f.name}`;status.textContent=`❌ حجم الملف كبير جدًا (${mb(f.size)}). الحد الأقصى 200 MB.`;processBtn.disabled=!0;fileInput.value='';return}
    info.textContent=`الملف: ${f.name} — ${mb(f.size)}`;processBtn.disabled=!1}
    drop.addEventListener('click',()=>fileInput.click());drop.addEventListener('dragover',e=>e.preventDefault());drop.addEventListener('drop',e=>{e.preventDefault();if(e.dataTransfer.files.length){fileInput.files=e.dataTransfer.files;updateInfo()}});fileInput.addEventListener('change',updateInfo);
    processBtn.addEventListener('click',async()=>{const f=fileInput.files[0];if(!f)return;const key=await getKey(!0);if(!key){alert('المفتاح مطلوب');return}const device=await getDeviceHash();status.textContent='جارٍ الرفع…';bar.classList.remove('running');bar.style.width='0%';processBtn.disabled=!0;fileInput.disabled=!0;drop.style.pointerEvents='none';drop.style.opacity='0.5';const fd=new FormData;fd.append('file',f);const xhr=new XMLHttpRequest;xhr.open('POST','/process',!0);xhr.responseType='blob';if(key!=="__DEVICE_ONLY__")xhr.setRequestHeader('X-KEY',key);xhr.setRequestHeader('X-DEVICE',device);xhr.setRequestHeader('X-DEVICE-NAME',getDeviceName());
    xhr.upload.onprogress=e=>{if(e.lengthComputable){bar.style.width=Math.round(e.loaded/e.total*100)+'%'}};xhr.onreadystatechange=()=>{if(xhr.readyState===XMLHttpRequest.HEADERS_RECEIVED){status.textContent='جارٍ تحسين الفيديو…';bar.classList.add('running')}};xhr.onload=()=>{bar.classList.remove('running');if(xhr.status===200){status.textContent='تمّت المعالجة — يبدأ التنزيل الآن';const blob=xhr.response,url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='output.mp4';document.body.appendChild(a);a.click();URL.revokeObjectURL(url);a.remove();setTimeout(()=>{drop.style.pointerEvents='auto';drop.style.opacity='1';fileInput.disabled=!1;fileInput.value='';updateInfo()},800)}else{const reader=new FileReader;reader.onload=()=>{if(xhr.status===403){status.textContent='⛔ انتهت صلاحية المفتاح. أدخل مفتاح جديد.';localStorage.removeItem('SUB_KEY')}else if(xhr.status===401){status.textContent='❌ المفتاح غير صالح';localStorage.removeItem('SUB_KEY')}else{status.textContent=reader.result||'حدث خطأ، حاول مجددًا.'}};reader.readAsText(xhr.response);drop.style.pointerEvents='auto';drop.style.opacity='1';fileInput.disabled=!1;updateInfo()}};xhr.onerror=()=>{bar.classList.remove('running');status.textContent='تعذّر الاتصال.';drop.style.pointerEvents='auto';drop.style.opacity='1';fileInput.disabled=!1;updateInfo()};xhr.send(fd)});
    async function refreshSubscriptionBox(auto=!1){try{const key=await getKey(!0);if(!key){if(!auto)alert('أدخل مفتاح الاشتراك أولاً');return}const device=await getDeviceHash();const headers={'X-DEVICE':device,'X-DEVICE-NAME':getDeviceName()};if(key!=="__DEVICE_ONLY__")headers['X-KEY']=key;const res=await fetch('/me',{headers});const data=await res.json();if(!res.ok){subKey.textContent='—';subExp.textContent='—';subDays.textContent='—';subBind.textContent=data.error||'غير متوفر';subDevice.textContent='—';subLast.textContent='—';return}let displayKey=data.key_masked||'—';const localKey=localStorage.getItem('SUB_KEY');if(localKey&&localKey!=="__DEVICE_ONLY__"){displayKey=localKey.substring(0,4)+"****"+localKey.slice(-4)}subKey.textContent=displayKey;subExp.textContent=data.expires||'—';subDays.textContent=data.days_left??'—';if(data.bound===!1)subBind.textContent='غير مربع بعد';else subBind.textContent=data.bound_to_this_device?'مربوط بهذا الجهاز':'مربوط بجهاز آخر';subDevice.textContent=data.device_name||'—';subLast.textContent=data.last_used?new Date(data.last_used).toLocaleString():'—';if(!auto){subToast.textContent='✅ تم تحديث معلومات الاشتراك';setTimeout(()=>subToast.textContent='',2000)}}catch(e){subToast.textContent='تعذر جلب معلومات الاشتراك';setTimeout(()=>subToast.textContent='',2000)}}
    showSubBtn?.addEventListener('click',()=>refreshSubscriptionBox(!1));
    window.addEventListener('load',()=>refreshSubscriptionBox(!0));
  </script>
</body>
</html>
